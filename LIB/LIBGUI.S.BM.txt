NEW
  AUTO 3,1
*--------------------------------------
BM.GetProps		>SS
				>PUSHYA					hBuf
				>PUSHWZ					start
				>PUSHWI S.BM			len
				>PUSHW L.TEXTBUF
				>KAPI GetBufData
				>SR
				rts
*--------------------------------------
BM.X2CBCache	>LDYA L.BMs,x
*--------------------------------------
BM.YA2CBCache	>STYA ZPpBM
				>STYA CB.Cache+S.CB.pSrc

				stz CB.Cache+S.CB.hSrc+1

				lda #S.CB.CMD.BITBLT
				sta CB.Cache+S.CB.CMD

				lda #S.CB.OP.MASK+S.CB.OP.ORA
				sta CB.Cache+S.CB.OP

				ldx #S.CB.M.MONO

				lda (ZPpBM)				#S.BM.F
				cmp #S.BM.F.BBP4
				bne .1

				lda #S.CB.OP.COLOR
				tsb CB.Cache+S.CB.OP

				lda CB.Cache+S.CB.X1
				and PREFS.BestViewedX
				sta CB.Cache+S.CB.X1

				ldx #S.CB.M.C16

.1				stx CB.Cache+S.CB.M

				jsr CB.ZeroSrcXSrcY

				ldy #S.BM.W+3
				ldx #3

.2				lda (ZPpBM),y
				sta CB.Cache+S.CB.SrcW,x
				dey
				dex
				bpl .2

				rts
*--------------------------------------
MAN
SAVE usr/src/lib/libgui.s.bm
LOAD usr/src/lib/libgui.s
ASM
