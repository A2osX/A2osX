NEW
PREFIX /A2OSX.BUILD
AUTO 4,1
				.LIST OFF	
*--------------------------------------
UDP.IN			jsr FRM.GetTargetSKT.TCPUDP

				jsr SKT.FindMatchingLocRem
				bcs .9

				ldy #S.SOCKET.PROTO
				lda (ZPPtrSKT),y
				cmp #S.IP.PROTOCOL.UDP
				bne .9
				
				lda hFrameIn
				jsr SKT.AddToQueueA
				bcc .8
			
.9				lda hFrameIn			Q full, discard...
				>SYSCALL FreeMem
.8				rts
*--------------------------------------
FRM.Dump		ldy #S.TCPUDP.DSTPORT
				lda (ZPFrameInPtr),y
				>PUSHA
				iny
				lda (ZPFrameInPtr),y
				>PUSHA
				
				ldy #S.IP.DST+3
				lda (ZPFrameInPtr),y
				>PUSHA
				dey
				lda (ZPFrameInPtr),y
				>PUSHA
				dey
				lda (ZPFrameInPtr),y
				>PUSHA
				dey
				lda (ZPFrameInPtr),y
				>PUSHA
				
				ldy #S.TCPUDP.SRCPORT
				lda (ZPFrameInPtr),y
				>PUSHA
				iny
				lda (ZPFrameInPtr),y
				>PUSHA
				
				ldy #S.IP.SRC+3
				lda (ZPFrameInPtr),y
				>PUSHA
				dey
				lda (ZPFrameInPtr),y
				>PUSHA
				dey
				lda (ZPFrameInPtr),y
				>PUSHA
				dey
				lda (ZPFrameInPtr),y
				>PUSHA
				
				>PUSHBI 12
				>LDYA L.MSG.FRM.Dump
				>SYSCALL Printf
				rts
*--------------------------------------
SKT.Dump		ldy #S.SOCKET.REM.PORT+1
				lda (ZPPtrSKT),y
				>PUSHA
				dey
				lda (ZPPtrSKT),y
				>PUSHA
				
				ldy #S.SOCKET.REM.ADDR+3
				lda (ZPPtrSKT),y
				>PUSHA
				dey
				lda (ZPPtrSKT),y
				>PUSHA
				dey
				lda (ZPPtrSKT),y
				>PUSHA
				dey
				lda (ZPPtrSKT),y
				>PUSHA
				
				ldy #S.SOCKET.LOC.PORT+1
				lda (ZPPtrSKT),y
				>PUSHA
				dey
				lda (ZPPtrSKT),y
				>PUSHA
				
				ldy #S.SOCKET.LOC.ADDR+3
				lda (ZPPtrSKT),y
				>PUSHA
				dey
				lda (ZPPtrSKT),y
				>PUSHA
				dey
				lda (ZPPtrSKT),y
				>PUSHA
				dey
				lda (ZPPtrSKT),y
				>PUSHA
				
				>PUSHBI 12
				>LDYA L.MSG.SKT.Dump
				>SYSCALL Printf
				rts
*--------------------------------------
MAN
SAVE /A2OSX.SRC/LIB/LIBTCPIP.S.UDP
LOAD /A2OSX.SRC/LIB/LIBTCPIP.S
ASM
