NEW
  AUTO 3,1
				.LIST OFF
				.OP	65C02
				.OR	$2000
				.TF sys/km.inet
*--------------------------------------
				.INB inc/macros.i
				.INB inc/a2osx.i
*--------------------------------------
*			File Header (16 Bytes)
*--------------------------------------
CS.START		cld
				jmp KM.Init				cld,jmp abs=DRV
				.DA #$61				6502,Level 1 (65c02)
				.DA #2					DRV Layout Version 2
				.DA 0
				.DA CS.END
				.DA ID.END
				.DA 0
				.DA 0
*--------------------------------------
* Relocation Table
*--------------------------------------
L.KM.CS.START	.DA KM.CS.START
				.DA 0					End Of Reloc Table
*--------------------------------------
KM.Init			>SS
				>PUSHW L.KM.CS.START
				>PUSHWI KM.CS.START
				>PUSHWI KM.CS.END
				>PUSHWI KM.ID.END
				>KAPI InsDrv
				>SR
				bcs .9

				pha
				tya
				ldy #AF_INET
				sec
				sbc #_Socket
				sta A2osX.pAFs,y
				pla
				sbc /_Socket
				sta A2osX.pAFs+1,y

				clc

.9				rts
*--------------------------------------
CS.END			.EQ *
*--------------------------------------
*			KM Code
*--------------------------------------
KM.CS.START		cld
				jmp (.1,x)

.1				.DA Socket
				.DA Bind
				.DA Connect
				.DA Listen
				.DA Accept
				.DA Shutdown
				.DA Recv
				.DA RecvFrom
				.DA RecvMsg
				.DA Send
				.DA SendMsg
				.DA SendTo
				.DA GetPeerName
				.DA GetSockName
				.DA GetSockOpt
				.DA SetSockOpt
*--------------------------------------
Socket
Bind
Connect
Listen
Accept
Shutdown
Recv
RecvFrom
RecvMsg
Send
SendMsg
SendTo
GetPeerName
GetSockName
GetSockOpt
SetSockOpt

				clc
				rts
*--------------------------------------
KM.CS.END		.EQ *
*--------------------------------------
KM.ID.END		.EQ *
*--------------------------------------
ID.END			.EQ *
*--------------------------------------
MAN
SAVE usr/src/sys/km.inet.s
ASM
