NEW
  AUTO 3,1
*--------------------------------------
X.IsIDValid		cmp #'.'
				beq X.8

				cmp #'_'
				beq X.8

X.IsDigitOrL	cmp #'z'+1
				bcs X.9

				cmp #'a'
				bcs X.8

				cmp #'Z'+1
				bcs X.9

				cmp #'A'
				bcs X.8

X.IsDigit		cmp #'9'+1
				bcs X.9

				cmp #'0'
				bcs X.8

				sec

				rts

X.8				clc

X.9				rts
*--------------------------------------
*X.AddYP1P1		sec
*
*				tya
*				adc ZPPtr1
*				sta ZPPtr1
*				bcc .8
*
*				inc ZPPtr1+1
*
*.8				rts
*--------------------------------------
*X.StrLenYA		>STYA .1+1
*
*				lda #0
*				tay
*
*.1				ldx $ffff,y
*				beq .8
*
*				iny
*				bne .1
*
*				inc
*				inc .1+2
*				bra .1
*
*.8				rts
*--------------------------------------
X.PathBuf2FORPNT
				lda FORPNT+1
				bne .1

				>LDYAI K.PATH.MAX
				jsr K.Malloc
				bcs .9

				>STYA FORPNT

.1				sta IO.SETWRITEAUX

				ldy #$ff

.2				iny
				lda K.PathBuf,y
				sta (FORPNT),Y
				bne .2

				sta IO.CLRWRITEAUX

				>LDYA FORPNT

				clc

.9				rts
*--------------------------------------
X.GethFDpFDA	sta IO.hFD
				tay
				lda pFDs+1,y
				beq .9

				sta pFD+1
				lda pFDs,y
				sta pFD

				clc
				rts

.9				lda #E.INVH
				sec
				rts
*--------------------------------------
X.ClrStat		ldx #S.STAT-1

.1				stz K.S.STAT,x
				dex
				bpl .1

				lda A2osX.FSID
				sta K.S.STAT+S.STAT.FSID

				lda #2
				sta K.S.STAT+S.STAT.BLKSIZE+1		= 512 bytes

				rts
*--------------------------------------
* Convert A to 2 hex digits in AX
*--------------------------------------
X.A2HAX			pha

				and #$0F
				jsr .8

				tax

				pla
				lsr
				lsr
				lsr
				lsr

.8				ora #$30
				cmp #'9'+1
				bcc .9

				adc #6

.9				rts
*--------------------------------------
X.xFORPNTpn		sta IO.SETWRITEAUX
				sta (FORPNT)
				sta IO.CLRWRITEAUX

				>INCW FORPNT

				rts
*--------------------------------------
MAN
SAVE usr/src/sys/kernel.s.shared
LOAD usr/src/sys/kernel.s
ASM
