NEW
  AUTO 3,1
*--------------------------------------
SOCK.Open		ldy IO.hFD
				lda #0					return int
*--------------------------------------
SOCK.Close		clc
				rts
*--------------------------------------
* From UNISTD.Read
*--------------------------------------
SOCK.Read		dec pStack
				dec pStack

				ldx #12					KM.Recv
				jsr K.2KM.FD

				inc pStack
				inc pStack

				rts
*--------------------------------------
* From UNISTD.Write
*--------------------------------------
SOCK.Write		dec pStack
				dec pStack

				ldx #18					KM.Send
				jsr K.2KM.FD

				inc pStack
				inc pStack

				rts
*--------------------------------------
* From STDIO.feof
* Recv(hFD, pbuf=NULL, length=0, flags=0)
*--------------------------------------
SOCK.EOF		sta IO.SETWRITEAUX

				lda IO.hFD
				>PUSHA

				lda #0
				ldx #7

.1				>PUSHA
				dex
				bne .1

				sta IO.SETWRITEAUX

				ldx #12					KM.Recv
				jsr K.2KM.FD

				php
				pha

				lda pStack
				clc
				adc #8
				sta pStack

				pla
				plp
				rts
*--------------------------------------
MAN
SAVE usr/src/sys/kernel.s.sock
LOAD usr/src/sys/kernel.s
ASM
